<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCF Validator: ebi::vcf::RecordCache Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VCF Validator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d1/d3d/classebi_1_1vcf_1_1_record_cache.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle"><div class="title">ebi::vcf::RecordCache Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for ebi::vcf::RecordCache:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/db6/classebi_1_1vcf_1_1_record_cache__coll__graph.png" border="0" usemap="#aebi_1_1vcf_1_1_record_cache_coll__map" alt="Collaboration graph"/></div>
<map name="aebi_1_1vcf_1_1_record_cache_coll__map" id="aebi_1_1vcf_1_1_record_cache_coll__map">
<area shape="rect" title=" " alt="" coords="5,5,193,205"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a53eea880b71319b86af56d52ba4fd53a" id="r_a53eea880b71319b86af56d52ba4fd53a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a53eea880b71319b86af56d52ba4fd53a">RecordCache</a> ()</td></tr>
<tr class="separator:a53eea880b71319b86af56d52ba4fd53a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a800635bf5cc345602bf3af398fa0a80f" id="r_a800635bf5cc345602bf3af398fa0a80f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a800635bf5cc345602bf3af398fa0a80f">RecordCache</a> (size_t capacity)</td></tr>
<tr class="separator:a800635bf5cc345602bf3af398fa0a80f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fbd1e312bc2b4cfa4cb96043c407e26" id="r_a2fbd1e312bc2b4cfa4cb96043c407e26"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr&lt; <a class="el" href="../../d6/d99/structebi_1_1vcf_1_1_error.html">Error</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2fbd1e312bc2b4cfa4cb96043c407e26">get_duplicates</a> ()</td></tr>
<tr class="separator:a2fbd1e312bc2b4cfa4cb96043c407e26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b93b3f82a2783b482df98798e2dd15d" id="r_a6b93b3f82a2783b482df98798e2dd15d"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr&lt; <a class="el" href="../../d6/d99/structebi_1_1vcf_1_1_error.html">Error</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b93b3f82a2783b482df98798e2dd15d">get_symbolic_duplicates</a> ()</td></tr>
<tr class="separator:a6b93b3f82a2783b482df98798e2dd15d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d0433ccab7c4be810b02cba0c9d4209" id="r_a6d0433ccab7c4be810b02cba0c9d4209"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6d0433ccab7c4be810b02cba0c9d4209">check_duplicates</a> (const <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a> &amp;record)</td></tr>
<tr class="separator:a6d0433ccab7c4be810b02cba0c9d4209"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada660e967cec3d3f00882d09ba42367c" id="r_ada660e967cec3d3f00882d09ba42367c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada660e967cec3d3f00882d09ba42367c">clear_cache_if_we_moved_to_the_next_chromosome</a> (const std::string &amp;chromosome)</td></tr>
<tr class="separator:ada660e967cec3d3f00882d09ba42367c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac09532f8fe43d736e4f3751a79d1a365" id="r_ac09532f8fe43d736e4f3751a79d1a365"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac09532f8fe43d736e4f3751a79d1a365">shrink_to_fit</a> (std::multiset&lt; <a class="el" href="../../d0/d82/structebi_1_1vcf_1_1_record_core.html">RecordCore</a> &gt; &amp;cache)</td></tr>
<tr class="separator:ac09532f8fe43d736e4f3751a79d1a365"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Stores a summary of a <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a> to check that there are no duplicates.</p>
<p>To limit memory usage, this class can be configured to store only the last <code>n</code> elements. This will only detect duplicates if the input is almost sorted (i.e. if no element is unsorted out of its place more than <code>n</code> elements) </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00037">37</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a53eea880b71319b86af56d52ba4fd53a" name="a53eea880b71319b86af56d52ba4fd53a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53eea880b71319b86af56d52ba4fd53a">&#9670;&#160;</a></span>RecordCache() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ebi::vcf::RecordCache::RecordCache </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Creates a cache that can hold at most 1000 entries. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00044">44</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   44</span>: <a class="code hl_function" href="#a53eea880b71319b86af56d52ba4fd53a">RecordCache</a>{1000} { }</div>
<div class="ttc" id="aclassebi_1_1vcf_1_1_record_cache_html_a53eea880b71319b86af56d52ba4fd53a"><div class="ttname"><a href="#a53eea880b71319b86af56d52ba4fd53a">ebi::vcf::RecordCache::RecordCache</a></div><div class="ttdeci">RecordCache()</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dde/record__cache_8hpp_source.html#l00044">record_cache.hpp:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a800635bf5cc345602bf3af398fa0a80f" name="a800635bf5cc345602bf3af398fa0a80f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a800635bf5cc345602bf3af398fa0a80f">&#9670;&#160;</a></span>RecordCache() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ebi::vcf::RecordCache::RecordCache </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>capacity</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">capacity</td><td>maximum amount of RecordCores that this instance can hold at any time. A value of 0 disables the limit, thus storing every <a class="el" href="../../d0/d82/structebi_1_1vcf_1_1_record_core.html">RecordCore</a> received. Use with caution. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00050">50</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   50</span>: capacity{capacity}, unlimited{capacity == 0} { }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6d0433ccab7c4be810b02cba0c9d4209" name="a6d0433ccab7c4be810b02cba0c9d4209"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d0433ccab7c4be810b02cba0c9d4209">&#9670;&#160;</a></span>check_duplicates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ebi::vcf::RecordCache::check_duplicates </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>record</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This function serves as the data generator to be used before utilizing <a class="el" href="#a2fbd1e312bc2b4cfa4cb96043c407e26">get_duplicates()</a> and <a class="el" href="#a6b93b3f82a2783b482df98798e2dd15d">get_symbolic_duplicates()</a> functions.</p>
<p>For a given <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a>, populates the list_duplicates and list_symbolic_duplicates vectors with non symbolic and symbolic duplicates respectively</p>
<p>Even if more than one duplicate is found for the same variant during the file validation, each occurrence is reported only once:</p><ul>
<li>If just one processed record is equivalent to the parameter, both are reported in 2 different errors.</li>
<li>If more than one processed record is equivalent to the new one, only the new one is reported.</li>
</ul>
<p>Nonetheless, if the capacity is too small, it may cause incorrect reporting, such as reporting several times the first occurrence or failing to report duplicates that are farther apart than the capacity. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00102">102</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  103</span>        {</div>
<div class="line"><span class="lineno">  104</span>            <span class="keyword">auto</span> record_cores = normalize(record);</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>            list_duplicates.clear();</div>
<div class="line"><span class="lineno">  107</span>            list_symbolic_duplicates.clear();</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>            <a class="code hl_function" href="#ada660e967cec3d3f00882d09ba42367c">clear_cache_if_we_moved_to_the_next_chromosome</a>(record.chromosome);</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>            <span class="keywordflow">for</span> (RecordCore &amp;record_core: record_cores) {</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>                <span class="comment">// create references to the appropriate data structures for th alternate allele type</span></div>
<div class="line"><span class="lineno">  114</span>                <span class="keyword">auto</span> &amp; cache = (record_core.alternate_allele_type == RecordType::STRUCTURAL) ? cache_symbolic_duplicates : cache_duplicates;</div>
<div class="line"><span class="lineno">  115</span>                <span class="keyword">auto</span> &amp; duplicates = (record_core.alternate_allele_type == RecordType::STRUCTURAL) ? list_symbolic_duplicates : list_duplicates;</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>                <span class="keyword">auto</span> range = cache.equal_range(record_core);</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>                <span class="keywordflow">if</span> (range.first == range.second) {</div>
<div class="line"><span class="lineno">  120</span>                    <span class="comment">// no matches found</span></div>
<div class="line"><span class="lineno">  121</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  122</span>                    <span class="comment">// one or more matches found</span></div>
<div class="line"><span class="lineno">  123</span>                    std::stringstream ss;</div>
<div class="line"><span class="lineno">  124</span>                    ss &lt;&lt; <span class="stringliteral">&quot;Duplicated variant &quot;</span> &lt;&lt; record_core.chromosome &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; record_core.position &lt;&lt; <span class="stringliteral">&quot;:&quot;</span></div>
<div class="line"><span class="lineno">  125</span>                    &lt;&lt; record_core.reference_allele &lt;&lt; <span class="stringliteral">&quot;&gt;&quot;</span> &lt;&lt; record_core.alternate_allele &lt;&lt; <span class="stringliteral">&quot; found&quot;</span>;</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>                    std::string duplicate_variant_lines = <span class="stringliteral">&quot;It occurs in lines &quot;</span> + std::to_string(range.first-&gt;line_num)</div>
<div class="line"><span class="lineno">  128</span>                                                          + <span class="stringliteral">&quot; and &quot;</span> + std::to_string(record_core.line_num);</div>
<div class="line"><span class="lineno">  129</span>                    <span class="keywordtype">size_t</span> first_occurence_line{range.first-&gt;line_num};</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>                    <span class="keywordflow">if</span> (++range.first == range.second) {</div>
<div class="line"><span class="lineno">  132</span>                        <span class="comment">// if only one match, return an extra error for the first occurrence</span></div>
<div class="line"><span class="lineno">  133</span>                        duplicates.emplace_back(<span class="keyword">new</span> DuplicationError{first_occurence_line, ss.str()});</div>
<div class="line"><span class="lineno">  134</span>                    }</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>                    duplicates.emplace_back(<span class="keyword">new</span> DuplicationError{record_core.line_num, ss.str(), duplicate_variant_lines});</div>
<div class="line"><span class="lineno">  137</span>                }</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>                cache.insert(range.second, record_core);</div>
<div class="line"><span class="lineno">  140</span>            }</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>            <a class="code hl_function" href="#ac09532f8fe43d736e4f3751a79d1a365">shrink_to_fit</a>(cache_symbolic_duplicates);</div>
<div class="line"><span class="lineno">  143</span>            <a class="code hl_function" href="#ac09532f8fe43d736e4f3751a79d1a365">shrink_to_fit</a>(cache_duplicates);</div>
<div class="line"><span class="lineno">  144</span>        }</div>
<div class="ttc" id="aclassebi_1_1vcf_1_1_record_cache_html_ac09532f8fe43d736e4f3751a79d1a365"><div class="ttname"><a href="#ac09532f8fe43d736e4f3751a79d1a365">ebi::vcf::RecordCache::shrink_to_fit</a></div><div class="ttdeci">void shrink_to_fit(std::multiset&lt; RecordCore &gt; &amp;cache)</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dde/record__cache_8hpp_source.html#l00175">record_cache.hpp:175</a></div></div>
<div class="ttc" id="aclassebi_1_1vcf_1_1_record_cache_html_ada660e967cec3d3f00882d09ba42367c"><div class="ttname"><a href="#ada660e967cec3d3f00882d09ba42367c">ebi::vcf::RecordCache::clear_cache_if_we_moved_to_the_next_chromosome</a></div><div class="ttdeci">void clear_cache_if_we_moved_to_the_next_chromosome(const std::string &amp;chromosome)</div><div class="ttdef"><b>Definition</b> <a href="../../d0/dde/record__cache_8hpp_source.html#l00164">record_cache.hpp:164</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00164">clear_cache_if_we_moved_to_the_next_chromosome()</a>, and <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00175">shrink_to_fit()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d3d/classebi_1_1vcf_1_1_record_cache_a6d0433ccab7c4be810b02cba0c9d4209_cgraph.png" border="0" usemap="#ad1/d3d/classebi_1_1vcf_1_1_record_cache_a6d0433ccab7c4be810b02cba0c9d4209_cgraph" alt=""/></div>
<map name="ad1/d3d/classebi_1_1vcf_1_1_record_cache_a6d0433ccab7c4be810b02cba0c9d4209_cgraph" id="ad1/d3d/classebi_1_1vcf_1_1_record_cache_a6d0433ccab7c4be810b02cba0c9d4209_cgraph">
<area shape="rect" title=" " alt="" coords="5,49,158,90"/>
<area shape="rect" href="../../d1/d3d/classebi_1_1vcf_1_1_record_cache.html#ada660e967cec3d3f00882d09ba42367c" title=" " alt="" coords="206,5,389,61"/>
<area shape="poly" title=" " alt="" coords="158,54,190,48,191,54,158,59"/>
<area shape="rect" href="../../d1/d3d/classebi_1_1vcf_1_1_record_cache.html#ac09532f8fe43d736e4f3751a79d1a365" title=" " alt="" coords="221,85,374,126"/>
<area shape="poly" title=" " alt="" coords="158,79,206,87,205,93,158,84"/>
</map>
</div>

</div>
</div>
<a id="ada660e967cec3d3f00882d09ba42367c" name="ada660e967cec3d3f00882d09ba42367c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada660e967cec3d3f00882d09ba42367c">&#9670;&#160;</a></span>clear_cache_if_we_moved_to_the_next_chromosome()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ebi::vcf::RecordCache::clear_cache_if_we_moved_to_the_next_chromosome </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;</td>          <td class="paramname"><span class="paramname"><em>chromosome</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>EVA-1950: the cache removes "lexicographically lower" chromosomes when the cache is full, but with that sorting, "chr10" is lower than "chr2", so new variants in "chr10" get deleted to keep the ones in "chr2", and duplicates in "chr10" will go undetected.</p>
<p><b>The chosen solution was to keep in the cache variants from only one chromosome at a time.</b></p>
<p>The next solutions were considered and <b>DISCARDED</b>:</p>
<ol type="1">
<li>Using Least Recently Used cache. This would require using esoteric data structures and/or dependencies, or keeping several simpler structures in sync, like a map and a queue that point to each other's contents.</li>
<li>A poor solution could be changing the ordering to "numerically lower", but that will be very tricky to get right with weird chrs like (versioned) accessions. e.g.: NC_01.1 is a chr, which is likely to appear before a contig GK_01.1, and we would need a sorting method that evaluates NC_01.1 &lt; GK_01.1.</li>
<li>Using the line number (Record::line) as sorting criteria. This wouldn't work because we need to group the same conceptual variants together to detect duplicates, and the multiset uses the comparator function to group the variants, which would never be grouped because the lines would be different. </li>
</ol>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00164">164</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  164</span>                                                                                         {</div>
<div class="line"><span class="lineno">  165</span>            <span class="keywordflow">if</span> (current_chromosome != chromosome) {</div>
<div class="line"><span class="lineno">  166</span>                cache_duplicates.clear();</div>
<div class="line"><span class="lineno">  167</span>                cache_symbolic_duplicates.clear();</div>
<div class="line"><span class="lineno">  168</span>                current_chromosome = chromosome;</div>
<div class="line"><span class="lineno">  169</span>            }</div>
<div class="line"><span class="lineno">  170</span>        }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00102">check_duplicates()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d3d/classebi_1_1vcf_1_1_record_cache_ada660e967cec3d3f00882d09ba42367c_icgraph.png" border="0" usemap="#ad1/d3d/classebi_1_1vcf_1_1_record_cache_ada660e967cec3d3f00882d09ba42367c_icgraph" alt=""/></div>
<map name="ad1/d3d/classebi_1_1vcf_1_1_record_cache_ada660e967cec3d3f00882d09ba42367c_icgraph" id="ad1/d3d/classebi_1_1vcf_1_1_record_cache_ada660e967cec3d3f00882d09ba42367c_icgraph">
<area shape="rect" title=" " alt="" coords="206,5,389,61"/>
<area shape="rect" href="../../d1/d3d/classebi_1_1vcf_1_1_record_cache.html#a6d0433ccab7c4be810b02cba0c9d4209" title=" " alt="" coords="5,13,158,54"/>
<area shape="poly" title=" " alt="" coords="191,36,158,36,158,31,191,31"/>
</map>
</div>

</div>
</div>
<a id="a2fbd1e312bc2b4cfa4cb96043c407e26" name="a2fbd1e312bc2b4cfa4cb96043c407e26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fbd1e312bc2b4cfa4cb96043c407e26">&#9670;&#160;</a></span>get_duplicates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; std::unique_ptr&lt; <a class="el" href="../../d6/d99/structebi_1_1vcf_1_1_error.html">Error</a> &gt; &gt; ebi::vcf::RecordCache::get_duplicates </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Getter function which returns a vector of Errors. For a given <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a>, returned Errors correspond to the duplicates found that aren't symbolic alleles.</p>
<p>Even if more than one duplicate is found for the same variant during the file validation, each occurrence is reported only once:</p><ul>
<li>If just one processed record is equivalent to the parameter, both are reported in 2 different errors.</li>
<li>If more than one processed record is equivalent to the new one, only the new one is reported.</li>
</ul>
<p>Nonetheless, if the capacity is too small, it may cause incorrect reporting, such as reporting several times the first occurrence or failing to report duplicates that are farther apart than the capacity. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00064">64</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   65</span>        {</div>
<div class="line"><span class="lineno">   66</span>            <span class="keywordflow">return</span> std::move(list_duplicates);</div>
<div class="line"><span class="lineno">   67</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6b93b3f82a2783b482df98798e2dd15d" name="a6b93b3f82a2783b482df98798e2dd15d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b93b3f82a2783b482df98798e2dd15d">&#9670;&#160;</a></span>get_symbolic_duplicates()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; std::unique_ptr&lt; <a class="el" href="../../d6/d99/structebi_1_1vcf_1_1_error.html">Error</a> &gt; &gt; ebi::vcf::RecordCache::get_symbolic_duplicates </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Getter function which returns a vector of Errors. For a given <a class="el" href="../../d6/d67/structebi_1_1vcf_1_1_record.html">Record</a>, returned Errors correspond to the duplicates found that are symbolic alleles.</p>
<p>Even if more than one duplicate is found for the same variant during the file validation, each occurrence is reported only once:</p><ul>
<li>If just one processed record is equivalent to the parameter, both are reported in 2 different errors.</li>
<li>If more than one processed record is equivalent to the new one, only the new one is reported.</li>
</ul>
<p>Nonetheless, if the capacity is too small, it may cause incorrect reporting, such as reporting several times the first occurrence or failing to report duplicates that are farther apart than the capacity. </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00081">81</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   82</span>        {</div>
<div class="line"><span class="lineno">   83</span>            <span class="keywordflow">return</span> std::move(list_symbolic_duplicates);</div>
<div class="line"><span class="lineno">   84</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ac09532f8fe43d736e4f3751a79d1a365" name="ac09532f8fe43d736e4f3751a79d1a365"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac09532f8fe43d736e4f3751a79d1a365">&#9670;&#160;</a></span>shrink_to_fit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ebi::vcf::RecordCache::shrink_to_fit </td>
          <td>(</td>
          <td class="paramtype">std::multiset&lt; <a class="el" href="../../d0/d82/structebi_1_1vcf_1_1_record_core.html">RecordCore</a> &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>cache</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>reduce cache size to this-&gt;capacity unless this-&gt;unlimited is true </p>

<p class="definition">Definition at line <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00175">175</a> of file <a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  176</span>        {</div>
<div class="line"><span class="lineno">  177</span>            <span class="keywordflow">if</span> (!unlimited) {</div>
<div class="line"><span class="lineno">  178</span>                <span class="keywordtype">size_t</span> count = cache.size();</div>
<div class="line"><span class="lineno">  179</span>                <span class="keywordflow">if</span> (count &gt; capacity) {</div>
<div class="line"><span class="lineno">  180</span>                    <span class="keyword">auto</span> erase_until = cache.begin();</div>
<div class="line"><span class="lineno">  181</span>                    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; count - capacity; ++j) {</div>
<div class="line"><span class="lineno">  182</span>                        erase_until++;</div>
<div class="line"><span class="lineno">  183</span>                    }</div>
<div class="line"><span class="lineno">  184</span>                    cache.erase(cache.begin(), erase_until);</div>
<div class="line"><span class="lineno">  185</span>                }</div>
<div class="line"><span class="lineno">  186</span>            }</div>
<div class="line"><span class="lineno">  187</span>        }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d0/dde/record__cache_8hpp_source.html#l00102">check_duplicates()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d3d/classebi_1_1vcf_1_1_record_cache_ac09532f8fe43d736e4f3751a79d1a365_icgraph.png" border="0" usemap="#ad1/d3d/classebi_1_1vcf_1_1_record_cache_ac09532f8fe43d736e4f3751a79d1a365_icgraph" alt=""/></div>
<map name="ad1/d3d/classebi_1_1vcf_1_1_record_cache_ac09532f8fe43d736e4f3751a79d1a365_icgraph" id="ad1/d3d/classebi_1_1vcf_1_1_record_cache_ac09532f8fe43d736e4f3751a79d1a365_icgraph">
<area shape="rect" title=" " alt="" coords="206,5,358,46"/>
<area shape="rect" href="../../d1/d3d/classebi_1_1vcf_1_1_record_cache.html#a6d0433ccab7c4be810b02cba0c9d4209" title=" " alt="" coords="5,5,158,46"/>
<area shape="poly" title=" " alt="" coords="190,28,158,28,158,23,190,23"/>
</map>
</div>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>inc/vcf/<a class="el" href="../../d0/dde/record__cache_8hpp_source.html">record_cache.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d9/d4b/namespaceebi.html">ebi</a></li><li class="navelem"><b>vcf</b></li><li class="navelem"><a class="el" href="../../d1/d3d/classebi_1_1vcf_1_1_record_cache.html">RecordCache</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
